# MySQL Slave Configuration for Multi-Region Deployment
# WinTrades Global Trading Platform

[mysqld]
# Server identification (will be overridden per region)
server-id = 2
read_only = 1
relay-log = relay-bin
relay-log-index = relay-bin.index

# Replication settings
slave_skip_errors = 1062,1032
slave_net_timeout = 60
slave_compressed_protocol = 1

# Performance optimizations
innodb_buffer_pool_size = 512M
innodb_log_file_size = 128M
innodb_log_buffer_size = 32M
innodb_flush_log_at_trx_commit = 2
innodb_flush_method = O_DIRECT

# Connection settings
max_connections = 300
max_connect_errors = 10000
connect_timeout = 60
wait_timeout = 28800
interactive_timeout = 28800

# Query cache
query_cache_type = 1
query_cache_size = 128M
query_cache_limit = 2M

# Table cache
table_open_cache = 1024
table_definition_cache = 512

# Thread settings
thread_cache_size = 32
thread_stack = 256K

# MyISAM settings
key_buffer_size = 128M
sort_buffer_size = 2M
read_buffer_size = 1M
read_rnd_buffer_size = 4M

# Networking
max_allowed_packet = 64M
bind-address = 0.0.0.0

# Logging
log-error = /var/log/mysql/error.log
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2

# Character set
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# Time zone
default-time-zone = '+00:00'

# Security
local-infile = 0

# GTID for easier failover
gtid_mode = ON
enforce_gtid_consistency = ON

# Semi-synchronous replication
plugin-load = "rpl_semi_sync_slave=semisync_slave.so"
rpl_semi_sync_slave_enabled = 1

# Slave optimizations
slave_parallel_type = LOGICAL_CLOCK
slave_parallel_workers = 4
slave_preserve_commit_order = 1
slave_pending_jobs_size_max = 128M